<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>职业规划助手 - AI赋能未来</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #0066CC;
            --secondary-color: #5E5CE6;
            --accent-color: #FF9500;
            --success-color: #34C759;
            --warning-color: #FF3B30;
            --background-start-color: #F9FAFC;
            --background-end-color: #FFFFFF;
            --card-background: #FFFFFF;
            --text-color: #1D1D1F;
            --light-text-color: #86868B;
            --border-color: #E5E5EA;
            --shadow-color: rgba(0, 0, 0, 0.05);
            --hover-primary-color: #0055BA;
            --font-family: -apple-system, BlinkMacSystemFont, 'Noto Sans SC', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            
            /* Dribbble风格渐变色 */
            --gradient-purple-pink: linear-gradient(135deg, #6366F1 0%, #FB7185 100%);
            --gradient-blue-purple: linear-gradient(135deg, #3B82F6 0%, #8B5CF6 100%);
            --gradient-green-blue: linear-gradient(135deg, #10B981 0%, #3B82F6 100%);
            --gradient-orange-red: linear-gradient(135deg, #F59E0B 0%, #EF4444 100%);
            --gradient-blue-teal: linear-gradient(135deg, #0EA5E9 0%, #14B8A6 100%);
            --gradient-pink-orange: linear-gradient(135deg, #EC4899 0%, #F97316 100%);
            --gradient-yellow-orange: linear-gradient(135deg, #FBBF24 0%, #F97316 100%);
            --gradient-gray-blue: linear-gradient(135deg, #94A3B8 0%, #475569 100%);
            --very-light-gray: #f8f9fa;
        }

        html { /* Explicitly reset html element's margin and padding */
            margin: 0;
            padding: 0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            line-height: 1.6;
            color: var(--text-color);
            background: linear-gradient(135deg, #f6f9fc, #eef1f5);
            overflow-x: hidden;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        #app-content-wrapper h1 {
            font-size: 2.4em;
            font-weight: 700;
            color: var(--text-color);
            text-align: center;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
            background: var(--gradient-blue-purple);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 1;
        }
        
        #app-content-wrapper .subtitle {
            text-align: center;
            font-size: 1.1em;
            color: var(--light-text-color);
            margin-bottom: 35px;
            font-weight: 400;
            position: relative;
            z-index: 1;
        }

        #app-content-wrapper h2 {
            font-size: 1.6em;
            font-weight: 600;
            color: var(--text-color);
            margin-top: 0;
            margin-bottom: 25px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
            letter-spacing: -0.3px;
            position: relative;
            z-index: 1;
        }
        
        .page-module {
            margin-bottom: 35px;
            padding: 35px 40px;
            background-color: var(--card-background); 
            border-radius: 20px; 
            box-shadow: 0 8px 30px rgba(0,0,0,0.07);
            position: relative;
            z-index: 1;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            max-width: 1000px;
            margin-left: auto; 
            margin-right: auto; 
        }
        
        .page-module:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 35px rgba(0,0,0,0.1);
        }

        .navbar {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 15px 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .navbar-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%; /* Make it take full width of parent .navbar */
            padding: 0 20px; /* Apply horizontal padding directly */
            box-sizing: border-box; /* Ensure padding is included in width */
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-blue-purple);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .cta-button {
            display: inline-block;
            padding: 12px 25px;
            background: var(--gradient-blue-purple);
            color: white !important;
            border-radius: 12px;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);
            cursor: pointer;
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.35);
        }

        .hero {
            padding: 150px 0 80px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            width: 600px;
            height: 600px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.08), rgba(251, 113, 133, 0.08));
            border-radius: 50%;
            top: -300px;
            right: -200px;
            z-index: -1;
        }

        .hero::after {
            content: '';
            position: absolute;
            width: 400px;
            height: 400px;
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.08), rgba(20, 184, 166, 0.08));
            border-radius: 50%;
            bottom: -200px;
            left: -100px;
            z-index: -1;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            line-height: 1.2;
            font-weight: 700;
            letter-spacing: -1px;
            color: var(--text-color);
            background: none;
            -webkit-background-clip: unset;
            -webkit-text-fill-color: unset;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 600px;
            margin: 0 auto 40px;
            color: var(--light-text-color);
        }

        .hero span {
            background: var(--gradient-blue-purple);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .cta-big-button {
            display: inline-block;
            padding: 16px 40px;
            background: var(--gradient-blue-purple);
            color: white !important;
            font-size: 1.2rem;
            border-radius: 16px;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
            cursor: pointer;
        }

        .cta-big-button:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 30px rgba(99, 102, 241, 0.4);
        }

        .features {
            padding: 100px 0;
        }

        .section-title {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 20px;
            font-weight: 700;
            color: var(--text-color);
        }

        .section-subtitle {
            text-align: center;
            font-size: 1.1rem;
            color: var(--light-text-color);
            max-width: 600px;
            margin: 0 auto 60px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .feature-card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient-purple-pink);
        }

        .feature-card:nth-child(2)::before {
            background: var(--gradient-blue-teal);
        }

        .feature-card:nth-child(3)::before {
            background: var(--gradient-orange-red);
        }

        .feature-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 20px;
            color: white;
        }

        .feature-card:nth-child(1) .feature-icon {
            background: var(--gradient-purple-pink);
        }

        .feature-card:nth-child(2) .feature-icon {
            background: var(--gradient-blue-teal);
        }

        .feature-card:nth-child(3) .feature-icon {
            background: var(--gradient-orange-red);
        }

        .feature-card h3 {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: var(--text-color);
        }

        .feature-card p {
            color: var(--light-text-color);
            line-height: 1.7;
        }

        .process {
            padding: 100px 0;
            background: #f8fafc;
        }

        .process-steps {
            display: flex;
            flex-direction: column;
            max-width: 700px;
            margin: 0 auto;
        }

        .process-step {
            display: flex;
            margin-bottom: 60px;
            position: relative;
        }

        .process-step:last-child {
            margin-bottom: 0;
        }

        .step-number {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            font-weight: 700;
            color: white;
            margin-right: 25px;
            flex-shrink: 0;
            position: relative;
            z-index: 2;
        }

        .process-step:nth-child(1) .step-number {
            background: var(--gradient-purple-pink);
        }

        .process-step:nth-child(2) .step-number {
            background: var(--gradient-blue-purple);
        }

        .process-step:nth-child(3) .step-number {
            background: var(--gradient-green-blue);
        }

        .process-step:nth-child(4) .step-number {
            background: var(--gradient-orange-red);
        }

        .step-content h3 {
            font-size: 1.4rem;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .step-content p {
            color: var(--light-text-color);
        }

        .process-step::before {
            content: '';
            position: absolute;
            left: 25px;
            top: 50px;
            width: 2px;
            height: calc(100% + 30px);
            background: #e5e7eb;
            z-index: 1;
        }

        .process-step:last-child::before {
            display: none;
        }

        .testimonials {
            padding: 100px 0;
        }

        .testimonials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .testimonial-card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            position: relative;
        }

        .testimonial-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .testimonial-text {
            font-style: italic;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
            color: var(--text-color);
        }

        .testimonial-text::before {
            content: '"';
            font-size: 5rem;
            position: absolute;
            top: -30px;
            left: -10px;
            color: rgba(99, 102, 241, 0.1);
            z-index: -1;
        }

        .testimonial-author {
            display: flex;
            align-items: center;
        }

        .author-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #f4f4f4;
            margin-right: 15px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #6366F1;
        }

        .author-info h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
            color: var(--text-color);
        }

        .author-info p {
            color: var(--light-text-color);
            font-size: 0.9rem;
        }

        .cta {
            padding: 100px 0;
            text-align: center;
            background: linear-gradient(135deg, #f6f9fc, #eef1f5);
        }

        .cta h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .cta p {
            font-size: 1.1rem;
            color: var(--light-text-color);
            max-width: 600px;
            margin: 0 auto 40px;
        }

        .footer {
            background: white;
            padding: 50px 0;
            text-align: center;
            border-top: 1px solid var(--border-color);
        }

        .footer p {
            color: var(--light-text-color);
        }

        .input-group {
            margin-bottom: 22px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--text-color);
            font-size: 0.95em;
        }
        
        .input-group input[type="text"],
        .input-group input[type="file"] {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-sizing: border-box;
            font-size: 1em;
            transition: all 0.3s ease;
            background-color: #F5F7FA;
        }
        
        .input-group input[type="text"]:focus,
        .input-group input[type="file"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0,102,204,.15);
            background-color: var(--card-background);
            outline: none;
        }

        .question-content p {
            font-weight: 500;
            font-size: 1.1em;
            margin-bottom: 18px;
            color: var(--text-color);
        }
        
        .question-content label {
            display: block;
            margin-bottom: 12px;
            padding: 14px 18px;
            border-radius: 12px;
            background-color: #F5F7FA;
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .question-content label:hover {
            background-color: #EFF1F5;
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .question-content input[type="radio"] {
            margin-right: 14px;
            vertical-align: middle;
            transform: scale(1.2);
            accent-color: var(--primary-color);
        }
        
        .question-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 25px;
        }
        
        .holland-progress-bar-container {
            width: 100%;
            background-color: #E5E5EA;
            border-radius: 8px;
            margin-bottom: 12px;
            overflow: hidden;
            height: 8px;
        }
        
        .holland-progress-bar {
            width: 0%;
            height: 100%;
            background: var(--gradient-yellow-orange);
            border-radius: 8px;
            transition: width 0.4s ease;
        }
        
        .holland-progress-text {
            text-align: center;
            font-size: 0.95em;
            color: var(--light-text-color);
            margin-bottom: 18px;
            font-weight: 500;
        }

        button {
            display: inline-block;
            padding: 14px 28px;
            background: var(--gradient-blue-purple);
            color: white;
            border: none;
            border-radius: 14px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.2s ease;
            letter-spacing: 0.3px;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
        
        button:disabled {
            background: #D1D1D6;
            color: #86868B;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        
        .button-container { 
            text-align: center;
            margin-top: 30px;
        }

        .results-section h2, .detailed-info-section h2 {
             margin-bottom: 28px;
        }

        .insight-section {
            margin-bottom: 30px;
        }

        .insight-card {
            background: white;
            border-radius: 16px;
            padding: 22px;
            margin-bottom: 16px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .insight-card:nth-child(1) {
            border-left: 4px solid transparent;
            background-image: linear-gradient(white, white), var(--gradient-purple-pink);
            background-origin: border-box;
            background-clip: padding-box, border-box;
        }
        
        .insight-card:nth-child(2) {
            border-left: 4px solid transparent;
            background-image: linear-gradient(white, white), var(--gradient-blue-teal);
            background-origin: border-box;
            background-clip: padding-box, border-box;
        }
        
        .insight-card:nth-child(3) {
            border-left: 4px solid transparent;
            background-image: linear-gradient(white, white), var(--gradient-yellow-orange);
            background-origin: border-box;
            background-clip: padding-box, border-box;
        }

        .insight-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        }

        .insight-card h3 {
            margin: 0 0 14px 0;
            color: var(--text-color);
            font-size: 1.25em;
            display: flex;
            align-items: center;
            letter-spacing: -0.5px;
        }

        .insight-card p {
            margin: 0;
            color: var(--light-text-color);
            font-size: 0.95em;
            line-height: 1.6;
        }

        .insight-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 10px;
            margin-right: 12px;
            font-size: 1.2em;
        }
        
        #mbti-insight .insight-icon {
            background: var(--gradient-purple-pink);
            box-shadow: 0 3px 10px rgba(99, 102, 241, 0.2);
            color: white;
        }
        
        #holland-insight .insight-icon {
            background: var(--gradient-blue-teal);
            box-shadow: 0 3px 10px rgba(14, 165, 233, 0.2);
            color: white;
        }
        
        #resume-insight .insight-icon {
            background: var(--gradient-yellow-orange);
            box-shadow: 0 3px 10px rgba(249, 115, 22, 0.2);
            color: white;
        }

        .career-recommendation {
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            position: relative;
            overflow: hidden;
        }
        
        .career-recommendation {
            border-left: 5px solid transparent;
            background-image: linear-gradient(white, white), var(--gradient-blue-purple);
            background-origin: border-box;
            background-clip: padding-box, border-box;
        }
        
        .career-recommendation:hover {
            transform: translateY(-6px) scale(1.01);
            box-shadow: 0 12px 30px rgba(0,0,0,0.1);
        }
        
        .career-recommendation h3 {
            margin: 0 0 10px 0;
            color: var(--text-color);
            font-size: 1.4em;
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
        }
        
        .career-recommendation .percentage {
            font-weight: 600;
            color: #F97316;
            margin-left: 8px;
            font-size: 0.85em;
            background: linear-gradient(90deg, #F97316, #FB7185);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .career-recommendation .short-desc {
            font-size: 1.05em;
            color: var(--light-text-color);
            margin-bottom: 12px;
            font-style: italic;
        }
        
        .career-recommendation .reason {
            font-size: 0.95em;
            color: var(--text-color);
            line-height: 1.6;
            padding-top: 12px;
            border-top: 1px solid #EFF1F5;
        }

        .detail-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .detail-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        }
        
        .detail-card h4 {
            color: var(--text-color);
            margin-top: 0;
            margin-bottom: 14px;
            font-size: 1.2em;
            font-weight: 600;
            padding-bottom: 10px;
            border-bottom: 1px solid #E5E5EA;
            letter-spacing: -0.3px;
            display: flex;
            align-items: center;
        }
        
        .detail-card:nth-child(1) h4 { color: #8B5CF6; }
        .detail-card:nth-child(2) h4 { color: #3B82F6; }
        .detail-card:nth-child(3) h4 { color: #10B981; }
        .detail-card:nth-child(4) h4 { color: #F59E0B; }
        .detail-card:nth-child(5) h4 { color: #EC4899; }
        
        .detail-card p, .detail-card ul {
            font-size: 0.95em;
            color: var(--text-color);
            line-height: 1.7;
        }
        
        .detail-card ul {
            list-style-position: outside;
            padding-left: 24px;
        }
        
        .detail-card li {
            margin-bottom: 10px;
        }

        .hidden {
            display: none !important;
        }
        
        .progress-container {
            width: 100%;
            max-width: 800px; 
            margin: 30px auto 50px auto; 
            position: relative;
            z-index: 1;
        }

        .progress-track {
            position: absolute; 
            width: 100%;
            height: 6px; 
            background-color: #E5E5EA;
            border-radius: 3px; 
            left: 0;
            top: 17px; 
            z-index: 1; 
        }
        
        .progress-bar { 
            height: 100%;
            background: var(--gradient-blue-purple);
            border-radius: 3px; 
            transition: width 0.6s ease;
            width: 0%;
        }
        
        .progress-steps {
            display: flex;
            justify-content: space-between;
            width: 100%;
            position: relative; 
            z-index: 2; 
        }
        
        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative; 
        }
        
        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 2px solid #E5E5EA;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px; 
            transition: all 0.3s ease;
            font-size: 18px;
            color: #94A3B8;
        }
        
        .step-label {
            font-size: 13px; 
            color: #94A3B8;
            font-weight: 500;
            transition: all 0.3s ease;
            text-align: center;
            max-width: 90px; 
            line-height: 1.3;
        }
        
        .progress-step.active .step-icon {
            border-color: #3B82F6;
            background: var(--gradient-blue-purple);
            color: white;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
        }
        
        .progress-step.active .step-label {
            color: #3B82F6;
            font-weight: 600;
        }
        
        .progress-step.completed .step-icon {
            background: var(--gradient-blue-teal);
            border-color: #0EA5E9;
            color: white;
        }
        
        .progress-step.completed .step-label {
            color: #0EA5E9;
        }

        .loading-container {
            text-align: center;
            padding: 40px 30px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.98);
            z-index: 1000;
            width: 85%;
            max-width: 440px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            animation: fadeInScale 0.3s ease forwards;
            border: 1px solid rgba(225, 230, 240, 0.7);
            opacity:0;
        }
        
        @keyframes fadeInScale {
            to { 
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        .loading-spinner {
            display: inline-block;
            width: 60px;
            height: 60px;
            background: conic-gradient(from 0deg, #3B82F6, #8B5CF6, #EC4899, #F97316, #3B82F6);
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
            margin-bottom: 5px;
            position: relative;
        }
        
        .loading-spinner::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            bottom: 8px;
            background: white;
            border-radius: 50%;
        }
        
        .loading-spinner::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.25);
        }

        .loading-progress-container {
            width: 100%;
            height: 8px;
            background-color: #E5E5EA;
            border-radius: 10px;
            margin: 25px 0;
            overflow: hidden;
            position: relative;
        }

        .loading-progress-bar {
            height: 100%;
            width: 0%;
            background: var(--gradient-blue-purple);
            border-radius: 10px;
            transition: width 0.5s linear;
            position: relative;
        }
        
        .loading-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                         transparent, 
                         rgba(255, 255, 255, 0.3), 
                         transparent);
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            from { transform: translateX(-100%); }
            to { transform: translateX(100%); }
        }

        .loading-text {
            color: var(--text-color);
            font-size: 18px;
            font-weight: 600;
            margin-top: 15px;
            letter-spacing: -0.3px;
        }
        
        .loading-subtext {
            color: var(--light-text-color);
            font-size: 14px;
            margin-top: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }
            .section-title {
                font-size: 2rem;
            }
            .process-step {
                flex-direction: column;
            }
            .step-number {
                margin-right: 0;
                margin-bottom: 15px;
            }
            .process-step::before {
                left: 25px;
                height: calc(100% + 15px);
                top: 50px;
            }

            .page-module { 
                padding: 25px 20px;
                margin-left: 15px; 
                margin-right: 15px;
                max-width: calc(100% - 30px); 
            }
            #app-content-wrapper h1 {
                font-size: 2em;
            }
            .progress-container {
                max-width: calc(100% - 30px);
                margin: 20px auto 40px auto; 
                padding-left: 10px; 
                padding-right: 10px;
                box-sizing: border-box;
            }
            .progress-track {
                height: 4px; 
                border-radius: 2px;
                top: 14px; 
            }
            .progress-bar {
                border-radius: 2px; 
            }
            .step-icon {
                width: 32px;
                height: 32px;
                font-size: 14px;
                margin-bottom: 6px; 
            }
            .step-label {
                font-size: 10px; 
                max-width: 60px; 
                line-height: 1.2;
            }
        }

        /* Added for new detail card structures */
        .detail-card .sub-module {
            margin-top: 20px; /* Increased margin for better separation */
            padding-top: 15px; /* Increased padding */
            border-top: 1px solid #EEF0F2; /* Slightly softer border color */
        }
        /* If a card only has sub-modules, the first one shouldn't have top margin/padding if no other content preceded it */
        .detail-card > .sub-module:first-child {
             margin-top: 0;
             padding-top: 0;
             border-top: none;
        }

        .detail-card .sub-module h5 {
            font-size: 1.1em; /* Slightly larger sub-heading */
            color: var(--primary-color); 
            margin-bottom: 10px; /* Increased margin */
            font-weight: 600; /* Bolder */
        }
        .workflow-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .workflow-table th, .workflow-table td {
            border: 1px solid var(--border-color);
            padding: 10px 12px;
            text-align: left;
            font-size: 0.9em;
            line-height: 1.5; /* Added for better readability in cells */
        }
        .workflow-table th {
            background-color: var(--very-light-gray); /* Using defined variable */
            font-weight: 600;
            color: var(--text-color);
        }
        .workflow-table td:first-child { /* Time column */
            width: 25%; /* Adjusted width */
            font-weight: 500;
            color: var(--secondary-color); /* Using defined variable */
            white-space: nowrap; /* Prevent time from wrapping */
        }
        /* Styling for development plan stages */
        #development-plan-content h5 {
            font-size: 1.1em;
            color: var(--primary-color);
            margin-top: 15px;
            margin-bottom: 8px;
            font-weight: 600;
        }
        #development-plan-content h5:first-child {
            margin-top: 0;
        }
        #development-plan-content p {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <div class="logo">AI职业规划助手</div>
            <button type="button" id="start-assistant-button-nav" class="cta-button">开始规划</button>
        </div>
    </nav>

    <div id="new-landing-page-content">
        <section class="hero">
            <div class="container">
                <h1>探索适合你的<span>职业新可能</span></h1>
                <p>基于AI深度分析，结合MBTI性格、霍兰德兴趣测评和个人简历，为你定制专属职业发展路径</p>
                <button type="button" id="start-assistant-button-hero" class="cta-big-button">立即开始测评</button>
            </div>
        </section>

        <section class="features">
            <div class="container">
                <h2 class="section-title">全方位的职业分析</h2>
                <p class="section-subtitle">我们从多个维度分析你的职业潜能，为你推荐最匹配的发展方向</p>
                
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">👤</div>
                        <h3>MBTI性格分析</h3>
                        <p>通过权威的MBTI性格测试，了解你的思维方式、决策偏好和社交取向，匹配适合你性格特质的职业领域。</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">🧩</div>
                        <h3>霍兰德兴趣测评</h3>
                        <p>基于霍兰德六边形理论，深入分析你的职业兴趣类型，让你找到真正热爱且能持续投入的工作方向。</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">📄</div>
                        <h3>简历能力识别</h3>
                        <p>AI技术自动分析你的简历，提取关键技能和经验优势，找出职场竞争力和潜在发展空间。</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="process">
            <div class="container">
                <h2 class="section-title">简单四步，规划未来</h2>
                <p class="section-subtitle">科学、高效的职业规划流程，只需几分钟即可获得专业分析</p>
                
                <div class="process-steps">
                    <div class="process-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3>输入基本信息</h3>
                            <p>提供MBTI性格类型、所在城市和上传个人简历，帮助我们初步了解你的背景。</p>
                        </div>
                    </div>
                    
                    <div class="process-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3>完成兴趣测评</h3>
                            <p>通过精心设计的霍兰德职业兴趣问卷，深入了解你的职业倾向和价值观。</p>
                        </div>
                    </div>
                    
                    <div class="process-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3>AI深度分析</h3>
                            <p>我们的AI系统整合多维度数据，分析你的优势、特质与各职业的匹配度。</p>
                        </div>
                    </div>
                    
                    <div class="process-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h3>获取职业洞察</h3>
                            <p>查看个性化报告，包含最匹配职业推荐、发展路径和具体建议。</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="testimonials">
            <div class="container">
                <h2 class="section-title">他们已找到职业方向</h2>
                <p class="section-subtitle">来自不同领域用户的真实感受</p>
                
                <div class="testimonials-grid">
                    <div class="testimonial-card">
                        <p class="testimonial-text">"之前对自己的职业方向非常迷茫，测评结果显示我适合创意领域。现在我是一名UI设计师，每天的工作都充满激情！"</p>
                        <div class="testimonial-author">
                            <div class="author-avatar">L</div>
                            <div class="author-info">
                                <h4>李明</h4>
                                <p>UI设计师 | ENFP</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="testimonial-card">
                        <p class="testimonial-text">"作为职场新人，我不确定自己的优势在哪里。AI分析帮我识别了数据分析能力，现在我在科技公司担任数据分析师。"</p>
                        <div class="testimonial-author">
                            <div class="author-avatar">Z</div>
                            <div class="author-info">
                                <h4>张晓华</h4>
                                <p>数据分析师 | INTJ</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="testimonial-card">
                        <p class="testimonial-text">"30岁想转行却不知从何开始。通过测评发现我有较强的人际沟通能力，现已成功转型为HR经理，找到了新的职业满足感。"</p>
                        <div class="testimonial-author">
                            <div class="author-avatar">W</div>
                            <div class="author-info">
                                <h4>王梦</h4>
                                <p>HR经理 | ESFJ</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="cta">
            <div class="container">
                <h2>开启你的职业新篇章</h2>
                <p>不再迷茫，找到真正适合你的职业方向</p>
                <button type="button" id="start-assistant-button-cta" class="cta-big-button">立即开始测评</button>
            </div>
        </section>

        <footer class="footer">
        <div class="container">
                <p>© 2024 AI职业规划助手 - 用AI技术探索职业可能性</p>
        </div>
        </footer>
    </div> <!-- Closes new-landing-page-content -->

    <div id="app-content-wrapper" class="hidden">
        <h1>职业规划助手</h1>
        <p class="subtitle">通过AI深度分析，为你量身定制职业发展方向</p>

        <div class="progress-container" id="progressContainer">
            <div class="progress-track">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="progress-steps">
                <div class="progress-step active" id="step-1">
                    <div class="step-icon">1</div>
                    <div class="step-label">基本信息</div>
                </div>
                <div class="progress-step" id="step-2">
                    <div class="step-icon">2</div>
                    <div class="step-label">兴趣测评</div>
                </div>
                <div class="progress-step" id="step-3">
                    <div class="step-icon">3</div>
                    <div class="step-label">AI分析</div>
                </div>
                <div class="progress-step" id="step-4">
                    <div class="step-icon">4</div>
                    <div class="step-label">职业洞察</div>
                </div>
                <div class="progress-step" id="step-5">
                    <div class="step-icon">5</div>
                    <div class="step-label">职业详情</div>
                </div>
            </div>
        </div>

        <div id="module-basic-info" class="page-module">
            <h2>第一步：基本信息</h2>
            <div class="input-group">
                <label for="resume">上传简历 (PDF 或 DOCX):</label>
                <input type="file" id="resume" name="resume" accept=".pdf,.doc,.docx">
            </div>
            <div class="input-group">
                <label for="mbti">你的MBTI类型 (例如 INFP):</label>
                <input type="text" id="mbti" name="mbti" placeholder="例如：ISTJ, ENFP">
            </div>
            <div class="input-group">
                <label for="city">你所在的城市:</label>
                <input type="text" id="city" name="city" placeholder="例如：北京, 上海">
            </div>
            <div class="button-container">
                <button id="next-to-holland">下一步：职业兴趣测试</button>
            </div>
        </div>

        <div id="module-holland-questions" class="page-module hidden">
            <h2>第二步：职业兴趣测试 (霍兰德模型)</h2>
            <div class="holland-progress-text" id="hollandProgressText">问题 1 / 10</div>
            <div class="holland-progress-bar-container">
                <div class="holland-progress-bar" id="hollandProgressBar"></div>
            </div>

            <div id="holland-questions-area">
                <div class="holland-question-container question-content" id="question-container-1">
                    <p>问题 1: 我更喜欢...</p>
                    <label><input type="radio" name="q1" value="R"> A. 从事需要动手能力、工具或机械操作的活动。</label>
                    <label><input type="radio" name="q1" value="I"> B. 思考、分析和解决复杂问题。</label>
                    <label><input type="radio" name="q1" value="A"> C. 进行创造性的自我表达，如写作、绘画、音乐。</label>
                    <label><input type="radio" name="q1" value="S"> D. 帮助、教导或服务他人。</label>
                    <label><input type="radio" name="q1" value="E"> E. 说服、领导或管理他人和项目。</label>
                    <label><input type="radio" name="q1" value="C"> F. 处理数据、关注细节、遵守规范和流程。</label>
                </div>
                <div class="holland-question-container question-content hidden" id="question-container-2">
                    <p>问题 2: 我对以下哪种工作环境最感兴趣？</p>
                    <label><input type="radio" name="q2" value="R"> A. 户外或涉及物理设备的环境。</label>
                    <label><input type="radio" name="q2" value="I"> B. 研究实验室或需要大量思考的环境。</label>
                    <label><input type="radio" name="q2" value="A"> C. 设计工作室、剧院或其他艺术场所。</label>
                    <label><input type="radio" name="q2" value="S"> D. 学校、医院、咨询中心等服务型机构。</label>
                    <label><input type="radio" name="q2" value="E"> E. 商业办公室、销售场合或管理层。</label>
                    <label><input type="radio" name="q2" value="C"> F. 有条不紊的办公室，注重准确性和效率。</label>
                </div>
                <div class="holland-question-container question-content hidden" id="question-container-3">
                    <p>问题 3: 我对以下哪些活动最感兴趣？</p>
                    <label><input type="radio" name="q3" value="R"> A. 修理或组装物品。</label>
                    <label><input type="radio" name="q3" value="I"> B. 进行科学实验或研究。</label>
                    <label><input type="radio" name="q3" value="A"> C. 创作艺术品或写故事。</label>
                    <label><input type="radio" name="q3" value="S"> D. 参加志愿者活动，帮助社区。</label>
                    <label><input type="radio" name="q3" value="E"> E. 组织团队或领导一个项目。</label>
                    <label><input type="radio" name="q3" value="C"> F. 制定详细的计划或预算。</label>
                </div>
                <div class="holland-question-container question-content hidden" id="question-container-4">
                    <p>问题 4: 我认为自己擅长...</p>
                    <label><input type="radio" name="q4" value="R"> A. 使用工具和设备。</label>
                    <label><input type="radio" name="q4" value="I"> B. 逻辑推理和批判性思维。</label>
                    <label><input type="radio" name="q4" value="A"> C. 想象和创新。</label>
                    <label><input type="radio" name="q4" value="S"> D. 理解和共情他人。</label>
                    <label><input type="radio" name="q4" value="E"> E. 沟通和说服。</label>
                    <label><input type="radio" name="q4" value="C"> F. 保持记录的准确性和条理性。</label>
                </div>
                <div class="holland-question-container question-content hidden" id="question-container-5">
                    <p>问题 5: 我更喜欢的工作方式是...</p>
                    <label><input type="radio" name="q5" value="R"> A. 有明确的、实际的任务。</label>
                    <label><input type="radio" name="q5" value="I"> B. 独立思考和探索新知识。</label>
                    <label><input type="radio" name="q5" value="A"> C. 自由表达，不受过多约束。</label>
                    <label><input type="radio" name="q5" value="S"> D. 与他人合作，共同达成目标。</label>
                    <label><input type="radio" name="q5" value="E"> E. 影响决策，承担责任。</label>
                    <label><input type="radio" name="q5" value="C"> F. 遵循既定程序，注重效率。</label>
                </div>
                <div class="holland-question-container question-content hidden" id="question-container-6">
                    <p>问题 6: 在解决问题时，我倾向于...</p>
                    <label><input type="radio" name="q6" value="R"> A. 寻找实际可行的解决方案。</label>
                    <label><input type="radio" name="q6" value="I"> B. 深入分析问题的根本原因。</label>
                    <label><input type="radio" name="q6" value="A"> C. 构思多种创新的可能性。</label>
                    <label><input type="radio" name="q6" value="S"> D. 考虑解决方案对他人的影响。</label>
                    <label><input type="radio" name="q6" value="E"> E. 带领团队找到并实施方案。</label>
                    <label><input type="radio" name="q6" value="C"> F. 确保方案的每个细节都得到妥善处理。</label>
                </div>
                <div class="holland-question-container question-content hidden" id="question-container-7">
                    <p>问题 7: 我理想中的工作成果是...</p>
                    <label><input type="radio" name="q7" value="R"> A. 创造出有形的、实用的东西。</label>
                    <label><input type="radio" name="q7" value="I"> B. 发现新的理论或知识。</label>
                    <label><input type="radio" name="q7" value="A"> C. 创作出能引起共鸣的艺术作品。</label>
                    <label><input type="radio" name="q7" value="S"> D. 对他人的生活产生积极影响。</label>
                    <label><input type="radio" name="q7" value="E"> E. 成功地领导并完成一个有影响力的项目。</label>
                    <label><input type="radio" name="q7" value="C"> F. 建立一个高效、有序的系统或流程。</label>
                </div>
                <div class="holland-question-container question-content hidden" id="question-container-8">
                    <p>问题 8: 我会被什么样的职业所吸引？</p>
                    <label><input type="radio" name="q8" value="R"> A. 工程师、机械师、电工。</label>
                    <label><input type="radio" name="q8" value="I"> B. 科学家、研究员、分析师。</label>
                    <label><input type="radio" name="q8" value="A"> C. 设计师、作家、音乐家。</label>
                    <label><input type="radio" name="q8" value="S"> D. 教师、顾问、社工。</label>
                    <label><input type="radio" name="q8" value="E"> E. 经理、企业家、销售。</label>
                    <label><input type="radio" name="q8" value="C"> F. 会计师、程序员、档案管理员。</label>
                </div>
                <div class="holland-question-container question-content hidden" id="question-container-9">
                    <p>问题 9: 当我学习新东西时，我更喜欢...</p>
                    <label><input type="radio" name="q9" value="R"> A. 通过实践和动手操作来学习。</label>
                    <label><input type="radio" name="q9" value="I"> B. 阅读、研究和独立思考。</label>
                    <label><input type="radio" name="q9" value="A"> C. 通过想象和尝试不同的方法来学习。</label>
                    <label><input type="radio" name="q9" value="S"> D. 与他人讨论和分享经验。</label>
                    <label><input type="radio" name="q9" value="E"> E. 领导一个学习小组或项目。</label>
                    <label><input type="radio" name="q9" value="C"> F. 按照结构化的课程和笔记来学习。</label>
                </div>
                <div class="holland-question-container question-content hidden" id="question-container-10">
                    <p>问题 10: 我认为一个好的团队应该...</p>
                    <label><input type="radio" name="q10" value="R"> A. 有明确分工，各司其职，高效完成任务。</label>
                    <label><input type="radio" name="q10" value="I"> B. 鼓励深度思考和知识分享。</label>
                    <label><input type="radio" name="q10" value="A"> C. 充满创意，鼓励尝试新想法。</label>
                    <label><input type="radio" name="q10" value="S"> D. 互相关怀，支持成员的个人成长。</label>
                    <label><input type="radio" name="q10" value="E"> E. 有强大的领导者和清晰的目标。</label>
                    <label><input type="radio" name="q10" value="C"> F. 有完善的制度和流程，确保工作质量。</label>
                </div>
            </div>

            <div class="question-navigation">
                <button id="prev-question-button" class="hidden">上一题</button>
                <button id="next-question-button">下一题</button>
                <button id="analyze-button" class="hidden">完成并分析</button>
            </div>
        </div>

        <div id="module-results" class="page-module hidden results-section">
            <h2>AI 职业分析与推荐</h2>
            
            <div class="insight-section">
                <div class="insight-card" id="mbti-insight">
                    <h3><div class="insight-icon">👤</div>MBTI 人格解读</h3>
                    <p>加载中...</p>
                </div>
                
                <div class="insight-card" id="holland-insight">
                    <h3><div class="insight-icon">🧩</div>霍兰德兴趣解读 (问卷分析)</h3>
                    <p>加载中...</p>
                </div>

                <div class="insight-card" id="resume-insight">
                    <h3><div class="insight-icon">📄</div>简历亮点与能力分析</h3>
                    <p>如果您上传了简历，AI将在此分析您的技能与经验。</p>
                </div>
            </div>
            
            <h3 style="margin-top: 30px; margin-bottom: 15px; color: var(--text-color);">初步职业推荐 (基于MBTI与霍兰德)</h3>
            <div id="career-recommendations-mbti-holland">
                <!-- MBTI + Holland recommendations will be populated here -->
                <p>正在等待初步分析结果...</p>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 15px; color: var(--text-color);">深入职业推荐 (结合简历分析)</h3>
            <div id="career-recommendations-full">
                <!-- MBTI + Holland + Resume recommendations will be populated here -->
                <p>如果您上传了简历，AI将在此提供更全面的推荐。</p>
            </div>
        </div>

        <div id="module-detailed-info" class="page-module hidden detailed-info-section">
            <h2 id="detailed-career-name"></h2>
            <div id="detailed-career-content">
            </div>
            <div class="button-container">
                <button id="back-to-recommendations-button">返回职业列表</button>
            </div>
        </div>
    </div> <!-- Closes app-content-wrapper -->

    <div id="loading-animation" class="loading-container hidden">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loading-text">职业分析中...</div>
        <div class="loading-subtext" id="loading-subtext">AI正在分析你的个人特质和职业倾向，请稍候...</div>
        <div class="loading-progress-container">
            <div class="loading-progress-bar" id="loading-progress-bar"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const progressBar = document.getElementById('progressBar');
            const hollandProgressBar = document.getElementById('hollandProgressBar');
            const hollandProgressText = document.getElementById('hollandProgressText');

            const newLandingPageContent = document.getElementById('new-landing-page-content');
            const appContentWrapper = document.getElementById('app-content-wrapper');
            const navbar = document.querySelector('.navbar'); // Get navbar element
            
            const startButtonNav = document.getElementById('start-assistant-button-nav');
            const startButtonHero = document.getElementById('start-assistant-button-hero');
            const startButtonCta = document.getElementById('start-assistant-button-cta');

            const progressContainer = document.getElementById('progressContainer');


            const moduleBasicInfo = document.getElementById('module-basic-info');
            const moduleHollandQuestions = document.getElementById('module-holland-questions');
            const moduleResults = document.getElementById('module-results');
            const moduleDetailedInfo = document.getElementById('module-detailed-info');

            const nextToHollandButton = document.getElementById('next-to-holland');
            const prevQuestionButton = document.getElementById('prev-question-button');
            const nextQuestionButton = document.getElementById('next-question-button');
            const analyzeButton = document.getElementById('analyze-button');
            
            const recommendationsList = document.getElementById('career-recommendations-list');
            const detailedCareerName = document.getElementById('detailed-career-name');
            const detailedCareerContent = document.getElementById('detailed-career-content');
            const backToRecommendationsButton = document.getElementById('back-to-recommendations-button');

            const resumeInput = document.getElementById('resume');
            const mbtiInput = document.getElementById('mbti');
            const cityInput = document.getElementById('city');

            // New elements for staged recommendations
            const preliminaryRecommendationsList = document.getElementById('career-recommendations-mbti-holland');
            const fullRecommendationsList = document.getElementById('career-recommendations-full');
            const resumeInsightCard = document.getElementById('resume-insight'); // For resume text

            const numTotalHollandQuestions = 10;
            let currentHollandQuestion = 1;
            const hollandAnswers = {};

            // --- START: MBTI Data ---
            const mbtiData = {
                "ISTJ": {
                    title: "ISTJ (检查员/物流师)",
                    description: "严肃、安静、通过全面和可靠获得成功。实际、有序、实事求是、有逻辑、现实且可信赖。他们重视传统和忠诚，有明确的内部标准。",
                    strengths: ["一丝不苟、注重细节", "高度负责、值得信赖", "强大的组织能力", "遵守规则和秩序"],
                    weaknesses: ["有时显得固执、缺乏灵活性", "不太适应突发变化", "可能忽视他人情感需求", "倾向于过度批判"],
                    careers: ["审计、会计、项目管理、土木工程、法律、军事、数据库管理、供应链管理"]
                },
                "ISFJ": {
                    title: "ISFJ (守护者/照顾者)",
                    description: "安静、友好、负责任且有良心。致力于并坚定地履行他们的义务。彻底、任劳任怨、准确。忠诚、体贴、注意和记住他们重视的人的细节，关心他人的感受。",
                    strengths: ["富有同情心、乐于助人", "可靠、有奉献精神", "注重细节和实用性", "有耐心、善于倾听"],
                    weaknesses: ["倾向于过度牺牲自我", "不喜欢冲突、可能压抑自己", "对批评敏感", "不愿接受新方法"],
                    careers: ["护理、教学、社会工作、客户服务、行政管理、图书管理、人力资源专员"]
                },
                "INFJ": {
                    title: "INFJ (引领者/作家)",
                    description: "寻求意义和目的，关心他人。有强烈的价值观，有远见。通常具有说服力，有洞察力，致力于他们的想法。他们是独立的，有强烈的个人原则。",
                    strengths: ["富有洞察力、理解他人动机", "有创造力、富有想象力", "坚定执着、有远见", "有同情心、关心他人"],
                    weaknesses: ["有时过于理想主义", "对批评高度敏感", "有完美主义倾向", "可能忽视自身需求"],
                    careers: ["心理咨询、写作/编辑、艺术设计、教育、科研、非营利组织管理、人力资源发展"]
                },
                "INTJ": {
                    title: "INTJ (战略家/策划者)",
                    description: "具有原创思想，并有强大的动力去实现他们的想法和目标。能够迅速看到模式和可能性。战略家，有远见，有能力计划和执行复杂的项目。",
                    strengths: ["战略思维、有远见", "独立自主、自信", "逻辑性强、善于分析", "高标准、追求卓越"],
                    weaknesses: ["可能显得傲慢、不耐烦", "忽视他人情感、不善交际", "过于批判、要求苛刻", "不愿妥协"],
                    careers: ["科学研究、战略规划、管理咨询、技术工程、计算机编程、法律、金融分析"]
                },
                "ISTP": {
                    title: "ISTP (手艺人/鉴赏家)",
                    description: "容忍和灵活，是冷静的观察者，直到问题出现，然后迅速行动，找到可行的解决方案。分析什么使事物运转，并能轻松地从大量数据中找到核心。",
                    strengths: ["动手能力强、解决实际问题", "冷静客观、适应性强", "观察敏锐、注重效率", "喜欢探索和体验"],
                    weaknesses: ["可能显得冷漠、不合群", "不喜欢理论和抽象概念", "缺乏长远规划、容易冲动", "对规则和承诺感到束缚"],
                    careers: ["工程技术、机械维修、计算机技术支持、警察/消防员、飞行员、手工艺制作、体育运动"]
                },
                "ISFP": {
                    title: "ISFP (艺术家/创作者)",
                    description: "安静、友好、敏感且善良。享受当下，享受他们周围发生的事情。喜欢拥有自己的空间，并按照自己的时间表工作。忠于他们的价值观和对他们重要的人。",
                    strengths: ["富有艺术感、审美能力强", "温和友善、有同情心", "注重当下、享受生活", "忠于内心价值观"],
                    weaknesses: ["不喜欢冲突、逃避问题", "对批评敏感、容易受伤", "缺乏长远规划、随性", "不善于表达自己的需求"],
                    careers: ["艺术设计、音乐创作、时尚行业、烹饪、园艺、自由职业、兽医助理"]
                },
                "INFP": {
                    title: "INFP (哲学家/诗人)",
                    description: "理想主义者，忠于他们的价值观和对他们重要的人。想要一个符合他们价值观的外部生活。好奇，很快看到可能性，可以成为实施想法的催化剂。",
                    strengths: ["富有创造力、想象力丰富", "有同情心、理解他人", "坚持理想和价值观", "善于写作和表达情感"],
                    weaknesses: ["过于理想主义、不切实际", "对批评敏感、容易受挫", "不善于处理琐事和细节", "有时难以做决定"],
                    careers: ["写作/编辑、心理咨询、艺术创作、社会工作、教育研究、人力资源、非营利组织"]
                },
                "INTP": {
                    title: "INTP (逻辑学家/思想家)",
                    description: "寻求对事物进行逻辑解释。理论性和抽象性，对思想比对社交互动更感兴趣。安静、内向、灵活、适应性强。对他们感兴趣的问题有异常深入的专注。",
                    strengths: ["逻辑严谨、分析能力强", "富有创造力、思维活跃", "独立思考、不盲从", "对知识有强烈的好奇心"],
                    weaknesses: ["可能显得不近人情、忽视他人感受", "不善于处理实际事务", "过于挑剔、难以满足", "倾向于拖延、缺乏执行力"],
                    careers: ["科学研究、计算机编程、哲学、数学、战略分析、大学教授、技术写作"]
                },
                "ESTP": {
                    title: "ESTP (行动派/挑战者)",
                    description: "灵活和容忍，他们采取务实的方法，专注于即时结果。理论和概念性的解释使他们厌烦——他们想精力充沛地解决问题。",
                    strengths: ["行动力强、讲求实际", "适应性强、机智灵活", "善于交际、有说服力", "勇于冒险、乐于挑战"],
                    weaknesses: ["可能缺乏耐心、容易冲动", "不喜欢规则和约束", "有时会忽视他人感受", "不善于做长远规划"],
                    careers: ["销售、市场营销、创业、警察/消防员、急救服务、体育教练、项目管理（短期）"]
                },
                "ESFP": {
                    title: "ESFP (表演者/娱乐家)",
                    description: "外向、友好且接纳。热爱生活、人和物质享受。喜欢与他人一起工作，使事情发生。将常识和现实的方法带到他们的工作中，并使工作变得有趣。",
                    strengths: ["热情洋溢、富有感染力", "善于交际、喜欢与人互动", "注重实际、享受当下", "适应性强、乐于助人"],
                    weaknesses: ["可能过于关注享乐、缺乏自律", "不喜欢理论和抽象思考", "容易分心、难以坚持", "对批评敏感"],
                    careers: ["演艺、活动策划、销售、客户服务、旅游业、美容时尚、儿童教育"]
                },
                "ENFP": {
                    title: "ENFP (激励者/记者)",
                    description: "热情、富有想象力。认为生活充满了可能性。能够很快地在事件和信息之间建立联系，并根据他们看到的模式自信地进行。需要大量的肯定，并且很容易给予赞赏和支持。",
                    strengths: ["富有创造力、充满热情", "善于沟通、激励他人", "适应性强、乐于尝试新事物", "洞察力强、能看到可能性"],
                    weaknesses: ["容易分心、难以坚持完成任务", "不喜欢例行公事和细节", "可能过于理想化", "有时难以兑现承诺"],
                    careers: ["市场营销、广告创意、咨询、公共关系、写作/记者、人力资源、创业"]
                },
                "ENTP": {
                    title: "ENTP (发明家/辩论家)",
                    description: "敏捷、巧妙，并富有启发性。善于阅读他人。直言不讳，在争论中思维敏捷。善于分析复杂问题，并能迅速提出新的解决方案。",
                    strengths: ["富有创造力、思维敏捷", "善于辩论、有说服力", "适应性强、喜欢挑战", "战略眼光、能抓住机遇"],
                    weaknesses: ["可能显得好辩、不耐烦", "不喜欢细节和重复性工作", "有时难以集中精力完成任务", "可能忽视他人感受"],
                    careers: ["创业、咨询、法律（辩护律师）、市场营销、工程设计、政治、广播/媒体"]
                },
                "ESTJ": {
                    title: "ESTJ (管理者/监督者)",
                    description: "实际、现实、实事求是。果断，一旦做出决定就迅速行动。组织项目和人员以完成任务，专注于以最有效的方式获得结果。",
                    strengths: ["组织能力强、注重效率", "果断、有决断力", "负责任、值得信赖", "遵守规则、讲求实际"],
                    weaknesses: ["可能显得固执、缺乏灵活性", "不太关注他人情感需求", "有时过于专断", "不喜欢处理不确定性"],
                    careers: ["管理层、项目管理、金融、执法、军事指挥官、运营管理、工程管理"]
                },
                "ESFJ": {
                    title: "ESFJ (主人型/供给者)",
                    description: "热心、健谈、受欢迎。有责任心、合作，并积极参与社区活动。努力工作以确保事情顺利进行。喜欢在有组织和和谐的环境中工作。",
                    strengths: ["乐于助人、有同情心", "善于交际、有团队精神", "有责任心、注重细节", "营造和谐氛围"],
                    weaknesses: ["不喜欢冲突、可能过分迁就", "对批评敏感、寻求认可", "可能过于关注他人需求而忽视自己", "有时难以接受改变"],
                    careers: ["教学、护理、客户服务、人力资源、活动策划、行政管理、社区服务"]
                },
                "ENFJ": {
                    title: "ENFJ (教导者/主人公)",
                    description: "热情、富有同情心、反应灵敏且负责任。高度关注他人的情感、需求和动机。发现每个人身上的潜力，并希望帮助他人发挥潜力。",
                    strengths: ["富有魅力、善于激励他人", "有同情心、理解他人需求", "有组织能力、善于协调", "有远见、能鼓舞人心"],
                    weaknesses: ["可能过于理想主义、容易失望", "有时会过度干涉他人", "对批评敏感、寻求他人认可", "可能忽视自身需求"],
                    careers: ["教育、咨询、人力资源管理、公共关系、非营利组织领导、销售管理、教练"]
                },
                "ENTJ": {
                    title: "ENTJ (统帅/指挥官)",
                    description: "坦率、果断，并乐于承担领导角色。迅速看到不合逻辑和低效率的程序和政策，制定并实施全面的系统来解决组织问题。",
                    strengths: ["有远见、战略思维强", "果断、有领导力", "逻辑清晰、善于解决问题", "自信、有魄力"],
                    weaknesses: ["可能显得专横、不耐烦", "不太关注他人情感", "对不同意见缺乏耐心", "有时过于追求效率而忽视过程"],
                    careers: ["企业高管、管理咨询、创业、法律（律师/法官）、项目管理、金融分析、政治家"]
                }
            };
            // --- END: MBTI Data ---

            // --- START: Holland Data ---
            const hollandCodeData = {
                R: {
                    name: "现实型 (Realistic)",
                    description: "喜欢运用技能、工具和机器，动手能力强，偏好具体、实际的任务。适合与具体事物打交道的工作。",
                    careers: ["工程师、机械师、飞行员、计算机硬件技师、建筑工人、农民、警察、消防员"]
                },
                I: {
                    name: "研究型 (Investigative)",
                    description: "喜欢思考、分析、探索和解决问题，对科学和智力活动感兴趣。适合需要观察、评估、分析和解决复杂问题的工作。",
                    careers: ["科学家（物理、化学、生物等）、研究员、医生、数学家、计算机程序员、系统分析师、侦探"]
                },
                A: {
                    name: "艺术型 (Artistic)",
                    description: "喜欢通过艺术形式进行自我表达，富有创造力、想象力和直觉。适合非结构化、允许自我表达和创新的工作。",
                    careers: ["设计师（平面、室内、时尚等）、作家、音乐家、演员、画家、摄影师、广告创意人员"]
                },
                S: {
                    name: "社会型 (Social)",
                    description: "喜欢与人交往、帮助他人、教导或提供服务，关心社会问题。适合需要人际交往、同情心和教学能力的工作。",
                    careers: ["教师、辅导员、社会工作者、护士、人力资源专员、客户服务代表、牧师"]
                },
                E: {
                    name: "企业型 (Enterprising)",
                    description: "喜欢影响、说服、领导或管理他人以达到组织目标或经济利益。精力充沛、自信、有抱负。适合需要领导力、竞争和商业头脑的工作。",
                    careers: ["企业家、销售经理、市场营销专员、管理人员、律师、政治家、公共关系专员"]
                },
                C: {
                    name: "常规型 (Conventional)",
                    description: "喜欢处理数据、注重细节、遵守规则和程序，偏好有条理、结构化的任务。适合需要精确性、组织性和效率的工作。",
                    careers: ["会计师、行政助理、银行职员、图书管理员、计算机操作员、秘书、质量控制检查员"]
                }
            };
            // --- END: Holland Data ---

            function initializePage() {
                if(newLandingPageContent) newLandingPageContent.classList.remove('hidden');
                if(appContentWrapper) appContentWrapper.classList.add('hidden');
                if (progressContainer) progressContainer.classList.add('hidden');
                if (moduleBasicInfo) moduleBasicInfo.classList.add('hidden');
                if (moduleHollandQuestions) moduleHollandQuestions.classList.add('hidden');
                if (moduleResults) moduleResults.classList.add('hidden');
                if (moduleDetailedInfo) moduleDetailedInfo.classList.add('hidden');
                if (navbar) navbar.classList.remove('hidden'); // Show navbar on init
            }


            function updateMainProgress(step) {
                let progress = 0;
                if (step === 1) progress = 0; 
                else if (step === 2) progress = 25; 
                else if (step === 3) progress = 50; 
                else if (step === 4) progress = 75; 
                else if (step === 5) progress = 100; 
                
                if(progressBar) progressBar.style.width = progress + '%';
                
                const steps = document.querySelectorAll('.progress-step');
                steps.forEach((stepElement, index) => {
                    const stepNum = index + 1;
                    if(!stepElement) return;
                    
                    if (stepNum < step) {
                        stepElement.classList.remove('active');
                        stepElement.classList.add('completed');
                    } else if (stepNum === step) {
                        stepElement.classList.add('active');
                        stepElement.classList.remove('completed');
                    } else {
                        stepElement.classList.remove('active', 'completed');
                    }
                });
            }

            function showHollandQuestion(questionNumber) {
                document.querySelectorAll('.holland-question-container').forEach(q => q.classList.add('hidden'));
                const currentQContainer = document.getElementById(`question-container-${questionNumber}`);
                if (currentQContainer) {
                    currentQContainer.classList.remove('hidden');
                }

                hollandProgressText.textContent = `问题 ${questionNumber} / ${numTotalHollandQuestions}`;
                hollandProgressBar.style.width = ((questionNumber -1) / numTotalHollandQuestions) * 100 + '%'; 

                prevQuestionButton.classList.toggle('hidden', questionNumber === 1);
                nextQuestionButton.classList.toggle('hidden', questionNumber === numTotalHollandQuestions);
                analyzeButton.classList.toggle('hidden', questionNumber !== numTotalHollandQuestions);
                
                hollandProgressText.classList.remove('hidden');
                hollandProgressBar.parentElement.classList.remove('hidden');
            }

            if(nextToHollandButton) {
                nextToHollandButton.addEventListener('click', () => {
                    if (!mbtiInput.value.trim() || !cityInput.value.trim()) {
                        alert('请填写MBTI和城市信息。'); 
                        return;
                    }
                    if(moduleBasicInfo) moduleBasicInfo.classList.add('hidden');
                    if(moduleHollandQuestions) moduleHollandQuestions.classList.remove('hidden');
                    currentHollandQuestion = 1;
                    showHollandQuestion(currentHollandQuestion);
                    updateMainProgress(2);
                    window.scrollTo(0, 0);
                });
            }

            if(nextQuestionButton){
                nextQuestionButton.addEventListener('click', () => {
                    const currentAnswer = document.querySelector(`input[name="q${currentHollandQuestion}"]:checked`);
                    if (!currentAnswer) {
                        alert('请选择一个答案后再进入下一题。');
                        return;
                    }
                    hollandAnswers[`q${currentHollandQuestion}`] = currentAnswer.value;

                    if (currentHollandQuestion < numTotalHollandQuestions) {
                        currentHollandQuestion++;
                        showHollandQuestion(currentHollandQuestion);
                    } 
                    if(currentHollandQuestion === numTotalHollandQuestions && hollandProgressBar) {
                         hollandProgressBar.style.width = (currentHollandQuestion / numTotalHollandQuestions) * 100 + '%'; 
                    }
                });
            }

            if(prevQuestionButton){
                prevQuestionButton.addEventListener('click', () => {
                    if (currentHollandQuestion > 1) {
                        currentHollandQuestion--;
                        showHollandQuestion(currentHollandQuestion);
                    }
                });
            }

            if(analyzeButton) {
                analyzeButton.addEventListener('click', () => {
                    const currentAnswer = document.querySelector(`input[name="q${currentHollandQuestion}"]:checked`);
                    if (!currentAnswer) {
                        alert('请回答当前问题以完成分析。');
                        return;
                    }
                    hollandAnswers[`q${currentHollandQuestion}`] = currentAnswer.value;
                    
                    if (Object.keys(hollandAnswers).length < numTotalHollandQuestions) {
                        alert('请确保所有霍兰德问题都已回答。');
                        return;
                    }
                    handleAnalysis();
                });
            }

            if(backToRecommendationsButton) {
                backToRecommendationsButton.addEventListener('click', showRecommendationsView);
            }
            
            function showLoadingAnimation(message = "正在分析中...", subtext = "AI正在深度分析你的个人特质和职业倾向，请稍候...") {
                const loadingElement = document.getElementById('loading-animation');
                const loadingTextElement = document.getElementById('loading-text');
                const loadingSubtextElement = document.getElementById('loading-subtext');
                const loadingProgressBarElement = document.getElementById('loading-progress-bar');
                
                if(!loadingElement || !loadingTextElement || !loadingSubtextElement || !loadingProgressBarElement) return { completeLoading: () => {}, setLoadingText: () => {} };

                loadingTextElement.textContent = message;
                loadingSubtextElement.textContent = subtext;
                loadingProgressBarElement.style.width = '0%';
                loadingElement.classList.remove('hidden');
                
                let progress = 0;
                // Adjust totalTime based on expected duration for each stage
                const totalTime = message.includes("初步分析中") ? 8000 : (message.includes("深入分析中") ? 12000 : 5000);
                const interval = 200; 
                const increment = (interval / totalTime) * 100;
                
                const progressIntervalId = setInterval(() => {
                    progress += increment;
                    if (progress < 70) progress += Math.random() * 0.5;
                    else if (progress < 90) progress += Math.random() * 0.2;
                    if (progress > 99) progress = 99;
                    if(loadingProgressBarElement) loadingProgressBarElement.style.width = `${progress}%`;
                }, interval);
                
                return {
                    completeLoading: () => {
                        clearInterval(progressIntervalId);
                        if(loadingProgressBarElement) loadingProgressBarElement.style.width = '100%';
                        setTimeout(() => {
                            if(loadingElement) loadingElement.classList.add('hidden');
                        }, 500);
                    },
                    setLoadingText: (newMessage, newSubtext) => {
                        if(loadingTextElement) loadingTextElement.textContent = newMessage;
                        if(loadingSubtextElement) loadingSubtextElement.textContent = newSubtext;
                    }
                };
            }

            async function handleAnalysis() {
                const resumeFile = resumeInput.files[0];
                const mbti = mbtiInput.value.trim();
                const city = cityInput.value.trim();
                
                if(analyzeButton) {
                    analyzeButton.disabled = true;
                    analyzeButton.textContent = "分析中...";
                }
                
                let loadingAnimationHandler;
                updateMainProgress(3); // Set overall progress to AI Analysis stage

                try {
                    // Stage 1: Preliminary Analysis (MBTI + Holland)
                    const preliminaryFormData = new FormData();
                    preliminaryFormData.append('mbti', mbti);
                    preliminaryFormData.append('city', city);
                    preliminaryFormData.append('holland_answers', JSON.stringify(hollandAnswers));

                    loadingAnimationHandler = showLoadingAnimation("AI初步分析中...", "正在分析您的MBTI与霍兰德兴趣类型，请稍候...");
                    
                    const preliminaryResponse = await fetch('http://47.110.41.233:5000/api/analyze-preliminary', { 
                        method: 'POST',
                        body: preliminaryFormData,
                    });
                    
                    if (!preliminaryResponse.ok) {
                        const errorData = await preliminaryResponse.text();
                        throw new Error(`初步分析服务器返回错误: ${preliminaryResponse.status} - ${errorData}`);
                    }
                    
                    const preliminaryData = await preliminaryResponse.json();
                    // No need to complete loading here, it will be completed after stage 2 or if no resume
                    
                    // Display preliminary insights (MBTI and Holland from frontend, recommendations from backend)
                    displayInsightsAndRecommendations(preliminaryData, "preliminary");
                    showResultsPage(); // Show results page with preliminary data

                    // Stage 2: Full Analysis (if resume is provided)
                    if (resumeFile) {
                        if (loadingAnimationHandler) loadingAnimationHandler.setLoadingText("AI深入分析中...", "正在结合您的简历进行分析，请稍候...");
                        else loadingAnimationHandler = showLoadingAnimation("AI深入分析中...", "正在结合您的简历进行分析，请稍候...");

                        const fullFormData = new FormData();
                        fullFormData.append('mbti', mbti);
                        fullFormData.append('city', city);
                        fullFormData.append('holland_answers', JSON.stringify(hollandAnswers));
                        fullFormData.append('resume', resumeFile);

                        const fullResponse = await fetch('http://47.110.41.233:5000/api/analyze-full', { 
                            method: 'POST',
                            body: fullFormData,
                        });

                        if (!fullResponse.ok) {
                            const errorData = await fullResponse.text();
                            throw new Error(`深入分析服务器返回错误: ${fullResponse.status} - ${errorData}`);
                        }

                        const fullData = await fullResponse.json();
                        if(loadingAnimationHandler) loadingAnimationHandler.completeLoading();
                        displayInsightsAndRecommendations(fullData, "full"); 
                    } else {
                        if(loadingAnimationHandler) loadingAnimationHandler.completeLoading(); // Complete if no resume for stage 2
                        if(fullRecommendationsList) fullRecommendationsList.innerHTML = '<p>未上传简历，深入推荐部分将基于MBTI和霍兰德提供补充或重复初步结果。</p>';
                        if(resumeInsightCard) {
                            const pElem = resumeInsightCard.querySelector('p');
                            if (pElem) pElem.textContent = '未上传简历，无法进行简历分析。';
                        }
                        // If no resume, make a simulated slight delay before showing full section as complete
                        // This is a UX choice to show that the process considered a second step even if no resume
                        // For example, call displayInsightsAndRecommendations with preliminaryData again for the full section
                        // displayInsightsAndRecommendations(preliminaryData, "full"); 
                        // Or simply leave the fullRecsList message as set above.
                    }
                    updateMainProgress(4); // Final progress update to Career Insights

                } catch (error) {
                    if(loadingAnimationHandler && typeof loadingAnimationHandler.completeLoading === 'function') {
                         loadingAnimationHandler.completeLoading();
                    }
                    alert(`分析错误: ${error.message}`);
                    // Reset button state
                    if(analyzeButton){
                        analyzeButton.disabled = false;
                        analyzeButton.textContent = "完成并分析";
                    }
                    // Potentially reset view to an earlier stage
                    // initializePage(); 
                }
            }

            function parseInsightText(insightText, analysisStage = "preliminary") {
                let mbtiContent = ""; 
                let hollandContent = "";
                let resumeContent = "";

                const defaultMessages = {
                    holland: "AI未能提供明确的霍兰德兴趣解读或服务器未返回相关信息。",
                    resume: "AI未能提供明确的简历分析或服务器未返回相关信息。如果您已上传简历，请检查服务器响应。"
                };
                
                // If insightText is an object (preferred from backend)
                if (typeof insightText === 'object' && insightText !== null) {
                    hollandContent = insightText.holland_insight || "";
                    resumeContent = insightText.resume_insight || "";
                    // mbtiContent = insightText.mbti_insight || ""; // If backend also provides MBTI text
                }
                // If insightText is a string (fallback, less ideal)
                else if (typeof insightText === 'string' && insightText.trim() !== "") {
                    if (analysisStage === "preliminary") {
                        // Assume string insightText from preliminary might be Holland or a general mix
                        hollandContent = insightText;
                    } else if (analysisStage === "full") {
                        // Assume string insightText from full is primarily resume or a more detailed mix
                        resumeContent = insightText; 
                        // Potentially, try to parse Holland from it too if mixed, but complex
                    }
                }

                return {
                    mbti: mbtiContent, 
                    holland: hollandContent.trim() || (analysisStage === "preliminary" || analysisStage === "full" ? defaultMessages.holland : ""),
                    resume: resumeContent.trim() || (analysisStage === "full" ? defaultMessages.resume : "")
                };
            }
            
            function formatInsightText(text) {
                const keywordsToHighlight = ['适合', '优势', '强项', '特长', '建议', '推荐', '性格特点', '特质', '能力', '专长', '技能', '倾向', '兴趣', '方向', '发展', '职业路径'];
                let formattedText = text.replace(/\n/g, '<br>');
                keywordsToHighlight.forEach(keyword => {
                    const regex = new RegExp(`(${keyword})`, 'g');
                    formattedText = formattedText.replace(regex, '<strong style="color: #3B82F6;">$1</strong>');
                });
                return formattedText;
            }

            function displayInsightsAndRecommendations(data, analysisStage = "preliminary") {
                // Handle MBTI using standardized content (always available)
                const mbtiType = mbtiInput.value.trim().toUpperCase();
                const mbtiPElem = document.querySelector('#mbti-insight p');
                const mbtiTitleElem = document.querySelector('#mbti-insight h3');

                if (mbtiData[mbtiType] && mbtiPElem && mbtiTitleElem) {
                    const typeInfo = mbtiData[mbtiType];
                    mbtiTitleElem.innerHTML = `<div class="insight-icon">👤</div>${typeInfo.title}`;
                    let mbtiHtml = `<strong>基本特点:</strong> ${typeInfo.description}<br><br>`;
                    mbtiHtml += `<strong>主要优势:</strong><ul>`;
                    typeInfo.strengths.forEach(s => mbtiHtml += `<li>${s}</li>`);
                    mbtiHtml += `</ul><br>`;
                    mbtiHtml += `<strong>潜在弱点:</strong><ul>`;
                    typeInfo.weaknesses.forEach(w => mbtiHtml += `<li>${w}</li>`);
                    mbtiHtml += `</ul><br>`;
                    mbtiHtml += `<strong>适合领域参考:</strong> ${typeInfo.careers}`;
                    mbtiPElem.innerHTML = mbtiHtml;
                } else if (mbtiPElem) {
                    mbtiPElem.innerHTML = "请输入有效的MBTI类型（例如 INFP, ESTJ）以获取解读。";
                     if (mbtiTitleElem) mbtiTitleElem.innerHTML = `<div class="insight-icon">👤</div>MBTI 人格解读`;
                }

                // Parse backend insights if provided
                // `data.insight` from backend could be a string or an object like { holland_insight: "...", resume_insight: "..." }
                const parsedBackendInsights = data.insight ? parseInsightText(data.insight, analysisStage) 
                                                            : parseInsightText("", analysisStage); // Provide default empty strings if no insight

                // --- START: Holland Frontend Scoring & Display (Primarily from questionnaire) ---
                const hollandPElem = document.querySelector('#holland-insight p');
                const hollandTitleElem = document.querySelector('#holland-insight h3');
                let frontendHollandInterpretation = "";
                const scores = { R: 0, I: 0, A: 0, S: 0, E: 0, C: 0 };
                
                if (Object.keys(hollandAnswers).length === numTotalHollandQuestions) {
                    for (const q in hollandAnswers) {
                        if (scores.hasOwnProperty(hollandAnswers[q])) {
                            scores[hollandAnswers[q]]++;
                        }
                    }
                    const sortedScores = Object.entries(scores).sort(([,a],[,b]) => b-a);
                    frontendHollandInterpretation = "<strong>根据您的问卷回答，您的主要职业兴趣类型可能为：</strong><br>";
                    let topTypesInfo = [];
                    for (let i = 0; i < Math.min(sortedScores.length, 3); i++) {
                        const typeCode = sortedScores[i][0];
                        const score = sortedScores[i][1];
                        if (score > 0 && hollandCodeData[typeCode]) {
                            const typeData = hollandCodeData[typeCode];
                            topTypesInfo.push(
                                `<strong>${i+1}. ${typeData.name} (得分: ${score})</strong>: ${typeData.description}<br><em>参考领域: ${typeData.careers.join(', ')}</em>`
                            );
                        } else if (i === 0) { break; }
                    }
                    if (topTypesInfo.length > 0) {
                        frontendHollandInterpretation += topTypesInfo.join("<br><br>");
                    } else {
                         frontendHollandInterpretation = "未能根据您的问卷回答计算出明确的霍兰德兴趣类型。请确保已完整回答问卷。";
                    }
                } else {
                    frontendHollandInterpretation = "请先完成霍兰德职业兴趣问卷，以获取您的兴趣类型分析。";
                }
                
                if (hollandPElem) {
                    // Frontend interpretation is primary for Holland card.
                    // If backend provides a specific Holland insight, you could append it:
                    let combinedHollandText = frontendHollandInterpretation;
                    if (parsedBackendInsights.holland && parsedBackendInsights.holland !== parseInsightText("", analysisStage).holland) {
                         combinedHollandText += "<br><br><strong>AI补充分析 (霍兰德):</strong><br>" + formatInsightText(parsedBackendInsights.holland);
                    }
                    hollandPElem.innerHTML = combinedHollandText;
                }
                if (hollandTitleElem) {
                     hollandTitleElem.innerHTML = `<div class=\"insight-icon\">🧩</div>霍兰德兴趣解读 (问卷分析)`;
                }
                // --- END: Holland Frontend Scoring & Display ---

                // --- START: Resume Insight Display (only for 'full' stage and if data exists) ---
                if (analysisStage === "full" && resumeInsightCard) {
                    const resumePElem = resumeInsightCard.querySelector('p');
                    const resumeTitleElem = resumeInsightCard.querySelector('h3'); 
                    if(resumePElem && resumeTitleElem){
                        if (parsedBackendInsights.resume && parsedBackendInsights.resume !== parseInsightText("", "full").resume) {
                            resumePElem.innerHTML = formatInsightText(parsedBackendInsights.resume);
                        } else if (resumeInput.files[0]) {
                            resumePElem.textContent = '简历已提交分析，AI正在处理或未能提取有效信息。若长时间未更新，请检查服务器日志。';
                        } else {
                            resumePElem.textContent = '未上传简历，无法进行简历分析。';
                        }
                    }
                }
                // --- END: Resume Insight Display ---
                
                // Determine which recommendation list to populate
                let targetRecommendationsList;
                let messageForOtherList = "";

                if (analysisStage === "preliminary") {
                    targetRecommendationsList = preliminaryRecommendationsList;
                    if(fullRecommendationsList) fullRecommendationsList.innerHTML = '<p>正在等待结合简历的深入分析...</p>'; // Update message for full list
                } else if (analysisStage === "full") {
                    targetRecommendationsList = fullRecommendationsList;
                    if(preliminaryRecommendationsList) {
                         // Decide how to handle preliminary list once full results are in
                         // Option 1: Hide it or clear it
                         // preliminaryRecommendationsList.classList.add('hidden');
                         // preliminaryRecommendationsList.innerHTML = '';
                         // Option 2: Update its message
                         preliminaryRecommendationsList.innerHTML = '<p>初步推荐已处理。请参考下方结合简历的深入推荐，或上方初步推荐（若内容不同）。</p>';
                    }
                } else {
                    // Should not happen with current logic
                    console.error("Unknown analysis stage for recommendations: ", analysisStage);
                    return; 
                }

                if(targetRecommendationsList) {
                    targetRecommendationsList.innerHTML = ''; // Clear previous content (e.g., "Loading...")
                    if (data.recommendations && data.recommendations.length > 0) {
                        data.recommendations.sort((a, b) => {
                            const getPercentageValue = (rec) => {
                                let p = rec.percentage || rec.match_percentage;
                                if (typeof p === 'string') {
                                    const numPart = parseFloat(p.replace('%', ''));
                                    return isNaN(numPart) ? 0 : numPart;
                                }
                                return typeof p === 'number' ? p : 0;
                            };
                            return getPercentageValue(b) - getPercentageValue(a);
                        });

                        data.recommendations.forEach(rec => {
                            const div = document.createElement('div');
                            div.classList.add('career-recommendation');
                            let percentageValue = rec.percentage || rec.match_percentage;
                            let percentageDisplay = "";
                            if (percentageValue) {
                                if (typeof percentageValue === 'number') {
                                    percentageDisplay = percentageValue + '%';
                                } else if (typeof percentageValue === 'string') {
                                    const numPart = parseFloat(percentageValue.replace('%', ''));
                                    if (!isNaN(numPart)) {
                                        percentageDisplay = numPart + '%';
                                    }
                                }
                            }
                            div.innerHTML = `
                                <h3>${rec.name} ${percentageDisplay ? `<span class="percentage">${percentageDisplay}</span>` : ''}</h3>
                                <div class="short-desc">${rec.short_description || ''}</div>
                                <div class="reason">${rec.reason || ''}</div>
                            `;
                            div.addEventListener('click', () => handleCareerSelection(rec)); // handleCareerSelection remains largely the same
                            targetRecommendationsList.appendChild(div);
                        });
                    } else {
                        targetRecommendationsList.innerHTML = `<p>抱歉，AI暂时未能针对此阶段生成职业推荐。请检查输入或稍后再试。</p>`;
                    }
                }
            }

            async function handleCareerSelection(career) {
                if(detailedCareerName) detailedCareerName.textContent = career.name + " - 详细职业洞察";
                if(detailedCareerContent) detailedCareerContent.innerHTML = "<div class='detail-card'><p>正在加载详细信息...</p></div>";
                
                if(moduleBasicInfo) moduleBasicInfo.classList.add('hidden');
                if(moduleHollandQuestions) moduleHollandQuestions.classList.add('hidden');
                if(moduleResults) moduleResults.classList.add('hidden');
                if(moduleDetailedInfo) moduleDetailedInfo.classList.remove('hidden');
                updateMainProgress(5); 
                window.scrollTo(0, 0);
                
                const loadingAnimation = showLoadingAnimation('正在深入分析『' + career.name + '』职业详情...', "AI正在生成更详细的职业洞察信息...");

                const cityVal = cityInput.value.trim();
                const mbtiVal = mbtiInput.value.trim();
                const resumeFile = resumeInput.files[0];
                
                const formData = new FormData();
                formData.append('career_id', career.id || '');
                formData.append('career_name', career.name);
                formData.append('city', cityVal);
                formData.append('mbti', mbtiVal);
                formData.append('holland_answers', JSON.stringify(hollandAnswers));
                if (resumeFile) formData.append('resume', resumeFile);

                try {
                    const response = await fetch('http://47.110.41.233:5000/api/career-details', {
                        method: 'POST',
                        body: formData
                    });
                    loadingAnimation.completeLoading();
                    if (!response.ok) {
                        const errorData = await response.text();
                        throw new Error('服务器返回错误: ' + response.status + ' - ' + errorData);
                    }
                    const details = await response.json();
                    displayDetailedInfo(details, cityVal);
                } catch (error) {
                    alert('获取职业详情失败: ' + error.message);
                    if(detailedCareerContent) detailedCareerContent.innerHTML = '<div class=\'detail-card\'><p>获取详细信息失败，请稍后再试。</p></div>';
                }
            }
            
            function displayDetailedInfo(details, cityForDisplay) {
                // MODIFICATION_MARKER_SKELETON_V1
                if(detailedCareerName) detailedCareerName.textContent = (details.name || "职业") + " - 详细职业洞察";
                if(detailedCareerContent) {
                    details = details || {}; 

                    let salaryInfoHtml = '<p>' + (details.salary_info ? String(details.salary_info).replace(/\n|\\n/g, '<br>') : '暂无薪资信息') + '</p>';
                    
                    // --- Development Plan - Populate with real data ---
                    let devPlanHtml = '<p>暂无发展规划信息</p>'; // Default message
                    if (details.development_plan) {
                        const planText = String(details.development_plan).replace(/\\\\n/g, '\n'); // Normalize newlines for splitting. Handles both \n and \\n from JSON
                        const stagesRaw = planText.split(/\n\s*(?=5年规划|10年规划|15年\+规划|初级阶段|中级阶段|高级阶段|短期目标|中期目标|长期目标|第一阶段|第二阶段|第三阶段|\d{1,2}年经验)/i);
                        
                        if (stagesRaw.length > 1 && stagesRaw.some(s => s.trim() !== planText.trim())) {
                            devPlanHtml = stagesRaw.map(stageText => stageText.trim())
                                                .filter(stageText => stageText) 
                                                .map(stageText => {
                                                    const firstLineEnd = stageText.indexOf('\n');
                                                    let firstLine = stageText.substring(0, firstLineEnd > 0 ? firstLineEnd : stageText.length);
                                                    firstLine = firstLine.replace(/^(【|〖|「|『)|(】|〗|」|』)$/g, '').trim(); // Remove surrounding brackets
                                                    const description = stageText.substring(firstLine.length).trim().replace(/^\n+|[:：\s]*\n/, '').replace(/\n/g, '<br>');
                                                    
                                                    if (/(规划|阶段|目标|经验)/.test(firstLine) && firstLine.length < 80 && !firstLine.includes('<') && description) { 
                                                        return '<h5>' + firstLine.replace(/[:：]$/, '') + '</h5><p>' + description + '</p>';
                                                    }
                                                    // If firstLine is not a good title, or no description, treat whole block as paragraph
                                                    return '<p>' + stageText.replace(/\n/g, '<br>') + '</p>';
                                                }).join('');
                        } else {
                            devPlanHtml = '<p>' + planText.replace(/\n/g, '<br>') + '</p>';
                        }
                         if (!devPlanHtml.trim() || devPlanHtml.trim() === '<p></p>') { // Check if after processing, it's effectively empty
                            devPlanHtml = '<p>暂无明确的发展阶段信息。</p>';
                        }
                    }
                    // --- End Development Plan ---
                    
                    let learningResourcesHtml = '<div><p>' + (details.learning_resources ? String(details.learning_resources).replace(/\n|\\n/g, '<br>') : '暂无学习资源信息') + '</p></div>';
                    
                    let hardSkillsContent = details.hard_skills ? String(details.hard_skills).replace(/\n|\\n/g, '<br>') : '暂无硬技能信息';
                    let softSkillsContent = details.soft_skills ? String(details.soft_skills).replace(/\n|\\n/g, '<br>') : '暂无软技能信息';
                    let mbtiAdvantageContent = details.mbti_advantage ? String(details.mbti_advantage).replace(/\n|\\n/g, '<br>') : '暂无MBTI优势分析信息';
                    
                    let coreCompetenciesFallbackHtml = '';
                    if (!details.hard_skills && !details.soft_skills && !details.mbti_advantage && details.core_competencies) {
                        coreCompetenciesFallbackHtml = '<div class="sub-module"><h5 style="color: #555;">综合核心能力 (后备)</h5><div><p>' + String(details.core_competencies).replace(/\n|\\n/g, '<br>') + '</p></div></div>';
                    } 

                    // --- START: 动态生成"日常工作一览"表格内容 ---
                    let dailyWorkflowTableRowsHtml = '';
                    // 优先尝试从 details.daily_workflow 获取，其次是 details['日常工作一览'] (可能由AI直接返回)，
                    // 再次是 details.insights['日常工作一览'] (如果insights对象存在)，最后是默认文本。
                    // 这是为了兼容后端可能通过不同字段名提供日常工作描述文本。
                    const dailyWorkText = details.daily_workflow || details['日常工作一览'] || (details.insights && details.insights['日常工作一览']) || "暂无相关信息";

                    // 预处理文本：统一换行符，按换行符分割成任务，去除首尾空格并过滤空行
                    const tasks = dailyWorkText.replace(/\\r\\n|\\r/g, '\\n').split('\\n').map(task => task.trim()).filter(task => task !== '');

                    if (tasks.length === 0 || (tasks.length === 1 && tasks[0] === "暂无相关信息")) {
                        // 如果没有任务或只有默认的"暂无信息"，则显示合并单元格的提示
                        dailyWorkflowTableRowsHtml = '<tr><td colspan="2">暂无相关信息</td></tr>';
                    } else {
                        // 定义时间段及其大致可容纳的任务数量
                        const timeSlotsDefinition = [ 
                            { slot: "09:00 - 10:00", tasks: [], capacity: 1 },
                            { slot: "10:00 - 12:00", tasks: [], capacity: 2 },
                            { slot: "13:00 - 15:00", tasks: [], capacity: 2 },
                            { slot: "15:00 - 17:00", tasks: [], capacity: 2 },
                            { slot: "其他/弹性时间", tasks: [], capacity: 10 } // "其他"时间段可以容纳更多任务
                        ];

                        let taskIndex = 0;
                        // 将任务分配到预设的时间段，同时考虑每个时间段的容量
                        for (let i = 0; i < timeSlotsDefinition.length && taskIndex < tasks.length; i++) {
                            let slot = timeSlotsDefinition[i];
                            for (let j = 0; j < slot.capacity && taskIndex < tasks.length; j++) {
                                slot.tasks.push(tasks[taskIndex]);
                                taskIndex++;
                            }
                        }
                        // 如果在分配完预设容量后仍有剩余任务，则将它们全部放入最后一个"其他/弹性时间"段
                        while(taskIndex < tasks.length) {
                            timeSlotsDefinition[timeSlotsDefinition.length - 1].tasks.push(tasks[taskIndex]);
                            taskIndex++;
                        }

                        let contentGenerated = false; // 标记是否成功生成了至少一行有效内容
                        timeSlotsDefinition.forEach(slotInfo => {
                            if (slotInfo.tasks.length > 0) {
                                // 同一时间段内的多个任务用 <br> 分隔显示
                                dailyWorkflowTableRowsHtml += `<tr><td>${slotInfo.slot}</td><td>${slotInfo.tasks.join('<br>')}</td></tr>`;
                                contentGenerated = true;
                            }
                        });
                        
                        if (!contentGenerated) { 
                            // 如果处理后依然没有可显示的任务内容（例如，原始文本只包含空行或被过滤掉的字符）
                             dailyWorkflowTableRowsHtml = '<tr><td colspan="2">未能有效解析日常工作内容或无具体任务项。</td></tr>';
                        }
                    }
                    // --- END: 动态生成"日常工作一览"表格内容 ---

                    let html = ''; // 重新初始化html字符串变量
                    html += '<div class="detail-card">';
                    html += '    <h4>💰 平均薪资参考 (' + (cityForDisplay || '当前城市') + ')</h4>';
                    html +=      salaryInfoHtml;
                    html += '</div>';
                    
                    html += '<div class="detail-card">';
                    html += '    <h4>🗺️ 发展规划蓝图</h4>';
                    html += '    <div id="development-plan-content">' + devPlanHtml + '</div>';
                    html += '</div>';

                    html += '<div class="detail-card">';
                    html += '    <h4>📚 推荐学习资源</h4>';
                    html +=      learningResourcesHtml;
                    html += '</div>';

                    html += '<div class="detail-card" id="core-competencies-card">';
                    html += '    <h4>🛠️ 核心能力模型</h4>';
                    html += '    <div class="sub-module">';
                    html += '        <h5>硬技能 (Hard Skills)</h5>';
                    html += '        <div id="hard-skills-content"><p>' + hardSkillsContent + '</p></div>';
                    html += '    </div>';
                    html += '    <div class="sub-module">';
                    html += '        <h5>软技能 (Soft Skills)</h5>';
                    html += '        <div id="soft-skills-content"><p>' + softSkillsContent + '</p></div>';
                    html += '    </div>';
                    html += '    <div class="sub-module">';
                    html += '        <h5>MBTI优势发挥 (Leveraging MBTI Strengths)</h5>';
                    html += '        <div id="mbti-advantage-content"><p>' + mbtiAdvantageContent + '</p></div>';
                    html += '    </div>';
                    html +=      coreCompetenciesFallbackHtml; 
                    html += '</div>';

                    html += '<div class="detail-card">';
                    html += '    <h4>⏰ 日常工作一览</h4>';
                    html += '    <table id="daily-workflow-table" class="workflow-table">';
                    html += '        <thead><tr><th>时间</th><th>活动内容</th></tr></thead>';
                    html += '        <tbody>' + dailyWorkflowTableRowsHtml + '</tbody>';
                    html += '    </table>';
                    html += '</div>';

                    detailedCareerContent.innerHTML = html;
                }
            }
            
            function showResultsPage() {
                if(moduleBasicInfo) moduleBasicInfo.classList.add('hidden'); // Hide basic info
                if(moduleHollandQuestions) moduleHollandQuestions.classList.add('hidden');
                if(moduleResults) moduleResults.classList.remove('hidden');
                if(moduleDetailedInfo) moduleDetailedInfo.classList.add('hidden');
                updateMainProgress(4);
                window.scrollTo(0, 0);
            }
            
            function showRecommendationsView() {
                if(moduleBasicInfo) moduleBasicInfo.classList.add('hidden'); // Hide basic info
                if(moduleDetailedInfo) moduleDetailedInfo.classList.add('hidden');
                if(moduleResults) moduleResults.classList.remove('hidden');
                updateMainProgress(4); 
                window.scrollTo(0, 0);
            }

            if (moduleHollandQuestions) showHollandQuestion(currentHollandQuestion);
            initializePage();

            function startAssistant() {
                if(newLandingPageContent) newLandingPageContent.classList.add('hidden');
                if(appContentWrapper) appContentWrapper.classList.remove('hidden');
                if (progressContainer) progressContainer.classList.remove('hidden');
                if (moduleBasicInfo) moduleBasicInfo.classList.remove('hidden');
                if (navbar) navbar.classList.add('hidden'); // Hide navbar when assistant starts
                updateMainProgress(1); 
                window.scrollTo(0, 0);
            }

            if (startButtonNav) {
                startButtonNav.addEventListener('click', startAssistant);
            }
            if (startButtonHero) {
                startButtonHero.addEventListener('click', startAssistant);
            }
            if (startButtonCta) {
                startButtonCta.addEventListener('click', startAssistant);
            }
        });
    </script>
</body>
</html> 